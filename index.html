<html>
  <head>
    <meta charset="utf-8"/>
    <link rel="stylesheet" href="style.css"/>
    <script src="cards.js"></script>
    <script src="cukas.js"></script>
    <script src="cukasController.js"></script>
    <script>

      //let deck = CardSet.standardPack();

      let cukasController;

      function newGame(playerCount, newController = false){
        const cukasGame = new CukasGame(playerCount); // Model

        if(cukasController === undefined || newController){
          const cukasContainer = document.getElementById("container"); // View
          cukasController = new CukasController(cukasGame, cukasContainer); // Controller
        } else {
          cukasController.updateModel(cukasGame);
        }

        cukasGame.init();

        return cukasGame;
      }

      function init() {
        newGame(4);

        // ----- Game save/load test -----
        /*
        const oldGame = newGame(4, true);
        const oldGameJSONData = JSON.stringify(oldGame, cukasGameRepl); // Get current game as a JSON string using custom replacer to insert metadata

        setTimeout(()=>{
          newGame(4, true);
        }, 5000);

        setTimeout(()=>{
          const loadedSave = JSON.parse(oldGameJSONData, cukasGameRev); // Parse JSON string into CukasGame object using custom reviver
          const loadedGame = loadedSave.saveData;

          console.log("Game saved at " + loadedSave.created);
          console.log(loadedGame);
          
          cukasController.updateModel(loadedGame); // Update controller with new model object
          loadedGame.init(); // Initialize the loaded game (updates the deck and hands onscreen)
        }, 10000);
        */

        console.log("Game initialized!");
      }

      window.addEventListener("load", init);

      /*
       const g = new CukasGame(3); // 3 players
       g.turn(); // Active player attacks
       g.turn(); // Next player defends
      */

    </script>

  </head>
  <body>
    <div id="container">
        <div class="trump-area">
          <h2>Kaudze un trumpis</h2>
          <div bind="supply">X</div>
        </div>

        <div class="main-area">
          <div class="slot">
            <h2>Uzbrukums 1</h2>
            <div bind="attack_1">X</div>
          </div>
          <div class="slot">
            <h2>Uzbrukums 2</h2>
            <div bind="attack_2">X</div>
          </div>
          <div class="slot">
            <h2>Uzbrukums 3</h2>
            <div bind="attack_3">X</div>
          </div>
          <div class="slot">
            <h2>Uzbrukums 4</h2>
            <div bind="attack_4">X</div>
          </div>
          <div class="slot">
            <h2>Uzbrukums 5</h2>
            <div bind="attack_5">X</div>
          </div>
          <div class="slot">
            <h2>Uzbrukums 6</h2>
            <div bind="attack_6">X</div>
          </div>
          <div class="slot">
            <h2>Aizsardzība 1</h2>
            <div bind="defence_1">X</div>
          </div>
          <div class="slot">
            <h2>Aizsardzība 2</h2>
            <div bind="defence_2">X</div>
          </div>
          <div class="slot">
            <h2>Aizsardzība 3</h2>
            <div bind="defence_3">X</div>
          </div>
          <div class="slot">
            <h2>Aizsardzība 4</h2>
            <div bind="defence_4">X</div>
          </div>
          <div class="slot">
            <h2>Aizsardzība 5</h2>
            <div bind="defence_5">X</div>
          </div>
          <div class="slot">
            <h2>Aizsardzība 6</h2>
            <div bind="defence_6">X</div>
          </div>
        </div>

        <div class="hands">
          <div id="hand1" class="hand">
            <h2>Roka 1</h2>
            <div bind="hand_1">X</div>
          </div>
          <div id="hand2" class="hand">
            <h2>Roka 2</h2>
            <div bind="hand_2">X</div>
          </div>
          <div id="hand3" class="hand">
            <h2>Roka 3</h2>
            <div bind="hand_3">X</div>
          </div>
          <div id="hand4" class="hand">
            <h2>Roka 4</h2>
            <div bind="hand_4">X</div>
          </div>
        </div>

      </div>
  </body>
</html>
